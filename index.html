import React, { useEffect, useMemo, useRef, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";


// This version removes TypeScript-only syntax, fixes JSX comment, and simplifies the noise layer
// to avoid data-URI quoting issues. It also positions tiles via percentages for better responsiveness.

export default function MultiLanding() {
  const [spotlightOn, setSpotlightOn] = useState(true);
  const [cursor, setCursor] = useState({ x: 0, y: 0 });

  // Pinball dot state kept in a ref so RAF can mutate without re-render
  const ballRef = useRef({ x: 200, y: 200, vx: 2.3, vy: 1.7 });
  const ballEl = useRef(null);

  // Channels: pseudo "TV tiles" with gentle chaotic orbits
  const channels = useMemo(() =>
    Array.from({ length: 12 }).map((_, i) => ({
      id: i,
      w: 100 + ((i * 37) % 80),
      hRatio: 0.68,
      delay: (i * 0.15) % 1.2,
      hue: (i * 29) % 360,
      leftPct: (i * 8.3) % 90, // 0..90%
      topPct: (i * 11.7) % 80, // 0..80%
      speed: 12 + (i % 7),
    })),
  []);

  // Animate pinball ricochet
  useEffect(() => {
    let raf;
    const step = () => {
      const W = window.innerWidth;
      const H = window.innerHeight;
      const b = ballRef.current;
      b.x += b.vx; b.y += b.vy;
      if (b.x < 20 || b.x > W - 20) b.vx *= -1;
      if (b.y < 20 || b.y > H - 20) b.vy *= -1;
      // jitter
      b.vx += (Math.random() - 0.5) * 0.02;
      b.vy += (Math.random() - 0.5) * 0.02;
      const cap = 3.2;
      b.vx = Math.max(Math.min(b.vx, cap), -cap);
      b.vy = Math.max(Math.min(b.vy, cap), -cap);
      if (ballEl.current) {
        ballEl.current.style.transform = `translate(${b.x}px, ${b.y}px)`;
      }
      raf = requestAnimationFrame(step);
    };
    // set initial position to avoid 0,0 flicker
    if (ballEl.current) {
      const b = ballRef.current;
      ballEl.current.style.transform = `translate(${b.x}px, ${b.y}px)`;
    }
    raf = requestAnimationFrame(step);
    return () => cancelAnimationFrame(raf);
  }, []);

  // Cursor tracking for spotlight
  useEffect(() => {
    const onMove = (e) => setCursor({ x: e.clientX, y: e.clientY });
    window.addEventListener("mousemove", onMove);
    return () => window.removeEventListener("mousemove", onMove);
  }, []);

  // Keyboard toggle for spotlight
  useEffect(() => {
    const onKey = (e) => {
      if (e.code === "Space") { e.preventDefault(); setSpotlightOn((v) => !v); }
    };
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, []);

  return (
    <div className="relative min-h-screen w-full overflow-hidden bg-black text-white">
      {/* Background textures: scanlines + soft vignette */}
      <div className="pointer-events-none absolute inset-0 opacity-30 mix-blend-screen"
           style={{
             backgroundImage:
               "repeating-linear-gradient(0deg, rgba(255,255,255,0.035) 0px, rgba(255,255,255,0.035) 1px, transparent 1px, transparent 3px)",
           }} />
      <div className="pointer-events-none absolute inset-0 opacity-20"
           style={{
             background:
               "radial-gradient(1200px 600px at 50% 50%, rgba(255,255,255,0.08), transparent 70%)",
           }} />

      {/* Title (only visible copy) */}
      <div className="absolute left-6 top-6 z-30">
        <motion.h1
          initial={{ opacity: 0, y: -10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="select-none font-bold tracking-tight text-4xl md:text-6xl"
          style={{ fontFamily: "Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif" }}
        >
          Satere Labs
        </motion.h1>
      </div>

      {/* Channels */}
      <div className="absolute inset-0">
        {channels.map((c) => (
          <motion.div
            key={c.id}
            className="absolute rounded-2xl shadow-2xl"
            initial={{ x: 0, y: 0, scale: 0.9, rotate: 0 }}
            animate={{
              x: [0, 40, -25, 10, 0],
              y: [0, -30, 35, -15, 0],
              rotate: [0, 2, -3, 1, 0],
              transition: { repeat: Infinity, duration: c.speed, ease: "easeInOut", delay: c.delay },
            }}
            style={{
              left: `${c.leftPct}%`,
              top: `${c.topPct}%`,
              width: c.w,
              height: c.w * c.hRatio,
              background:
                `conic-gradient(from 0deg, hsl(${c.hue} 80% 60% / .25), transparent 35%), ` +
                `radial-gradient(circle at 30% 20%, hsl(${(c.hue + 80) % 360} 90% 60% / .15), transparent 60%), ` +
                `rgba(255,255,255,0.05)`,
              backdropFilter: "blur(2px)",
              border: "1px solid rgba(255,255,255,0.08)",
              overflow: "hidden",
            }}
            whileHover={{ scale: 1.05 }}
            drag
            dragElastic={0.12}
            dragMomentum
          >
            {/* inner artifacts: scanlines + bloom */}
            <div className="h-full w-full" style={{
              backgroundImage: "repeating-linear-gradient(180deg, rgba(255,255,255,.06) 0 1px, transparent 1px 3px)",
            }}>
              <div className="h-full w-full mix-blend-screen opacity-60 animate-pulse" style={{
                background:
                  `radial-gradient(120px 80px at 70% 40%, rgba(255,255,255,.15), transparent 60%),`+
                  `radial-gradient(80px 60px at 20% 70%, rgba(255,255,255,.12), transparent 60%)`,
              }} />
            </div>
          </motion.div>
        ))}
      </div>

      {/* Central pulse (collapsing/expanding focus) */}
      <motion.div
        className="pointer-events-none absolute left-1/2 top-1/2 z-10 -translate-x-1/2 -translate-y-1/2 rounded-full"
        initial={{ scale: 0.8, opacity: 0.6 }}
        animate={{ scale: [0.8, 1.15, 0.9, 1.2, 0.8], opacity: [0.6, 0.35, 0.5, 0.3, 0.6] }}
        transition={{ duration: 6, repeat: Infinity, ease: "easeInOut" }}
        style={{
          width: 220,
          height: 220,
          boxShadow: "0 0 120px 40px rgba(120,140,255,0.12)",
          background:
            "radial-gradient(circle at 50% 50%, rgba(160,180,255,0.18), rgba(80,90,200,0.08) 60%, transparent 70%)",
        }}
      />

      {/* Ricochet pinball dot */}
      <div
        ref={ballEl}
        className="pointer-events-none absolute z-20 h-3 w-3 -translate-x-1/2 -translate-y-1/2 rounded-full"
        style={{ boxShadow: "0 0 16px 6px rgba(255,255,255,0.5)", background: "white" }}
      />

      {/* Spotlight mask */}
      <AnimatePresence>
        {spotlightOn && (
          <motion.div
            key="spotlight"
            className="pointer-events-none absolute inset-0 z-20"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
            style={{
              WebkitMaskImage: `radial-gradient(200px 200px at ${cursor.x}px ${cursor.y}px, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 60%)`,
              maskImage: `radial-gradient(200px 200px at ${cursor.x}px ${cursor.y}px, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 60%)`,
              background: "radial-gradient(circle at center, rgba(0,0,0,0), rgba(0,0,0,0.55))",
              backdropFilter: "blur(2px)",
            }}
          />
        )}
      </AnimatePresence>

      {/* Icon-only controls (left: spotlight toggle, right: reset ricochet) */}
      <div className="pointer-events-auto fixed bottom-6 left-6 z-40 flex items-center gap-4">
        <button
          aria-label="toggle"
          onClick={() => setSpotlightOn((v) => !v)}
          className="rounded-2xl border border-white/10 bg-white/5 p-3 shadow-lg backdrop-blur hover:bg-white/10"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
            <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6-10-6-10-6Z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
        <button
          aria-label="reset"
          onClick={() => {
            const b = ballRef.current;
            b.vx = (Math.random() * 2 - 1) * 3;
            b.vy = (Math.random() * 2 - 1) * 3;
          }}
          className="rounded-2xl border border-white/10 bg-white/5 p-3 shadow-lg backdrop-blur hover:bg-white/10"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
            <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
            <path d="M21 3v6h-6"/>
          </svg>
        </button>
      </div>

      {/* Visual hint (no text) */}
      <div className="absolute right-6 top-6 z-30 flex items-center gap-2">
        <span className="inline-block h-2 w-2 animate-ping rounded-full bg-white/70" />
        <span className="inline-block h-2 w-2 rounded-full bg-white/50" />
      </div>

      {/* Breathing baseline */}
      <motion.div
        className="pointer-events-none fixed bottom-0 left-0 right-0 z-0"
        initial={{ opacity: 0.35 }}
        animate={{ opacity: [0.35, 0.15, 0.3, 0.18, 0.35] }}
        transition={{ duration: 8, repeat: Infinity }}
        style={{ height: 2, background: "linear-gradient(90deg, transparent, rgba(255,255,255,.45), transparent)" }}
      />
    </div>
  );
}
